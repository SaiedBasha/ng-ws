"use strict";!function(){function n(){this._handlers={}}function e(){var e={url:null,reconnect:!0,reconnectInterval:2e3,lazyOpen:!1,protocols:null,enqueue:!1},t={},o=null,r={NOT_INITIALIZED:-1,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},i=null,l=[],u=!1,s=new n,c=function(){throw new Error("not initialized config")},a=function(n){if(s.deleteAll(),void 0===n||null==n||void 0===n.url||null===n.url||0==n.url.length)throw new Error("url must be specified at the config");return t=angular.extend({},e,n),e.lazyOpen||f(t),E},f=function(){h()!==r.OPEN&&h()!==r.CONNECTING&&(o=new WebSocket(t.url,t.protocols),o.onopen=function(){if(u=!1,i&&(clearInterval(i),i=null),t.enqueue&&l.length>0)for(;l.length>0&&h()==r.OPEN;)d(l.shift());w("open")},o.onerror=function(n){w("error",n)},o.onmessage=function(n){w("message",n)},o.onclose=function(n){t.reconnect&&u===!1&&!i&&(i=setInterval(function(){f(t)},t.reconnectInterval)),i||w("close",n)})},h=function(){return null===o||void 0===o?r.NOT_INITIALIZED:o.readyState},d=function(n){var e=h();if(e==r.OPEN)o.send(n);else if(e==r.NOT_INITIALIZED)c();else{if(!t.enqueue)throw new Error("connection not open");queue.push(message)}},p=function(n,e){h()!=r.CLOSED&&(u=!0,0===arguments.length?o.close():o.close(n,e)),i&&(clearInterval(i),i=null)},v=function(n){p(),a(n)},g=function(n,e){s.on(n,e)},I=function(n,e){s.un(n,e)},w=function(n,e){s.emit(n,e)},E={init:a,open:function(){p(),u=!1,f()},send:d,close:p,getState:h,updateConfig:v,queue:l,on:g,un:I};this.$get=function(){return E}}n.prototype={constructor:n,on:function(n,e){if("string"!=typeof n)throw new Error("invalid event name");if("function"!=typeof e)throw new Error("handler not a function");void 0===this._handlers[n]&&(this._handlers[n]=[]),this._handlers[n].push(e)},emit:function(n,e){if("string"!=typeof n)throw new Error("invalid event name");if(void 0===this._handlers[n]&&(this._handlers[n]=[]),this._handlers[n]instanceof Array)for(var t=this._handlers[n],o=0,r=t.length;r>o;o++)"function"==typeof t[o]&&t[o].call(this,e)},un:function(n,e){if("string"!=typeof n)throw new Error("invalid event name");if(this._handlers[n]instanceof Array)for(var t=this._handlers[n],o=t.length,r=0;o>r;r++)t[r]===e&&t.splice(r,1)},deleteAll:function(){for(var n in this._handlers)this._handlers.hasOwnProperty(n)&&delete this._handlers[n]}},angular.module("ng-ws",[]).provider("$ws",e)}();